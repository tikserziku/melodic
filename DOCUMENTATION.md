# Melodic Linker - Документация проекта

## Содержание
- [Обзор](#обзор)
- [Выполненные работы](#выполненные-работы)
- [Текущее состояние](#текущее-состояние)
- [Дальнейшие шаги](#дальнейшие-шаги)
- [Техническая документация](#техническая-документация)
- [Решенные проблемы](#решенные-проблемы)

## Обзор

Melodic Linker - это музыкальная стриминговая платформа для обмена и прослушивания музыкальных треков. Проект имеет два основных интерфейса:

1. **Публичная часть** - для прослушивания и взаимодействия с музыкой
2. **Административная панель** - для управления контентом

Демо проекта доступно по адресу: 
- Основной сайт: [https://muzik-2cf8c4ac10ed.herokuapp.com/](https://muzik-2cf8c4ac10ed.herokuapp.com/)
- Админ-панель: [https://muzik-2cf8c4ac10ed.herokuapp.com/admin.html](https://muzik-2cf8c4ac10ed.herokuapp.com/admin.html)
  - Логин: `tikserziku`
  - Пароль: `tikserziku01`

## Выполненные работы

### Общая архитектура
- ✅ Создана базовая структура проекта с разделением на frontend и backend
- ✅ Настроен Node.js + Express сервер
- ✅ Разработан RESTful API для управления музыкальными треками
- ✅ Настроена обработка статических файлов

### Фронтенд - публичная часть
- ✅ Создан адаптивный интерфейс с использованием Tailwind CSS
- ✅ Реализовано отображение и воспроизведение треков
- ✅ Добавлен индикатор воспроизведения активного трека
- ✅ Реализован функционал лайков (хранение в localStorage)
- ✅ Реализована система комментариев (хранение в localStorage)
- ✅ Добавлена возможность поделиться треком
- ✅ Удалена секция загрузки треков для обычных пользователей
- ✅ Добавлена ссылка на админ-панель

### Фронтенд - административная часть
- ✅ Создана защищенная паролем админ-панель
- ✅ Реализована авторизация администратора через localStorage
- ✅ Добавлена таблица треков с информацией о каждом треке
- ✅ Реализована форма загрузки новых треков с валидацией
- ✅ Добавлена возможность редактирования существующих треков
- ✅ Добавлена возможность удаления треков с подтверждением
- ✅ Реализован предпросмотр обложек

### Бэкенд
- ✅ Разработан API для работы с треками (CRUD операции)
- ✅ Настроено хранение и управление файлами (обложки и аудио)
- ✅ Добавлены валидации данных
- ✅ Реализовано хранение треков в памяти приложения
- ✅ Добавлены примеры треков для демонстрации

### Деплой и инфраструктура
- ✅ Создан Dockerfile для контейнеризации приложения
- ✅ Настроен деплой на Heroku через Docker
- ✅ Добавлена конфигурация для корректной работы в production
- ✅ Решена проблема с временным хранилищем файлов на Heroku

## Текущее состояние

### Интерфейс пользователя
На данный момент реализован полнофункциональный интерфейс пользователя, который позволяет:
- Просматривать список доступных треков
- Воспроизводить треки с индикацией активного трека
- Ставить лайки
- Оставлять и просматривать комментарии
- Делиться треками через ссылку

### Административная панель
Админ-панель позволяет выполнять все необходимые операции:
- Просмотр всех треков в системе
- Загрузка новых треков (аудиофайлы + обложки)
- Редактирование информации о треках
- Удаление треков

### Хранение данных
- Треки и их метаданные хранятся в памяти сервера
- Файлы хранятся во временной директории `/tmp` на Heroku
  - Это означает, что загруженные файлы могут быть потеряны при перезапуске приложения
  - В production-версии требуется интеграция с постоянным хранилищем

## Дальнейшие шаги

### Приоритетные задачи
1. **Интеграция с базой данных**
   - Подключение MongoDB для постоянного хранения метаданных треков
   - Создание моделей данных для пользователей, треков, плейлистов
   - Миграция текущего хранения в памяти на БД

2. **Интеграция с облачным хранилищем**
   - Настройка AWS S3 или аналогичного хранилища для файлов
   - Обновление API для работы с облачным хранилищем
   - Миграция временного хранения файлов на облачное

3. **Аутентификация и авторизация**
   - Разработка полноценной системы регистрации пользователей
   - Внедрение JWT для авторизации запросов
   - Разграничение прав доступа (пользователи, администраторы)

### Улучшения интерфейса
1. **Улучшение плеера**
   - Добавление плейлистов
   - Реализация очереди воспроизведения
   - Добавление визуализации аудио

2. **Пользовательские профили**
   - Личные страницы пользователей
   - История прослушиваний
   - Избранные треки

3. **Социальные возможности**
   - Подписки на других пользователей
   - Репосты треков
   - Уведомления о новых треках

### Технические улучшения
1. **Оптимизация производительности**
   - Кэширование запросов к API
   - Ленивая загрузка изображений
   - Прогрессивная загрузка аудио

2. **Мобильная оптимизация**
   - PWA для работы на мобильных устройствах
   - Оптимизация для сенсорного ввода
   - Режимы экономии трафика

## Техническая документация

### Структура проекта
```
/muzik
├── app.js                 # Главный файл приложения
├── backend/               # Бэкенд часть
│   ├── Dockerfile         # Конфигурация Docker для бэкенда
│   ├── package.json       # Зависимости бэкенда
│   └── src/               # Исходный код бэкенда
│       ├── app-simple.js  # API без базы данных
│       └── app.ts         # Версия с TypeScript (в разработке)
├── Dockerfile             # Главный Dockerfile для проекта
├── frontend/              # Полноценный фронтенд (в разработке)
│   └── src/               # React компоненты
├── heroku.yml             # Конфигурация для деплоя на Heroku
├── package.json           # Основные зависимости
├── Procfile               # Конфигурация для Heroku
├── README.md              # Документация проекта
├── server.js              # Альтернативный сервер
└── test-frontend/         # Тестовый интерфейс
    ├── admin.html         # Панель администратора
    └── index.html         # Публичная страница
```

### API Endpoints
| Метод | Путь | Описание |
|-------|------|----------|
| GET | /api/tracks | Получение списка треков |
| GET | /api/tracks/:id | Получение трека по ID |
| POST | /api/tracks | Загрузка нового трека |
| PUT | /api/tracks/:id | Обновление информации о треке |
| DELETE | /api/tracks/:id | Удаление трека |

### Формат данных трека
```json
{
  "id": "string",
  "title": "string",
  "artist": "string",
  "description": "string",
  "genre": "string",
  "coverImage": "string (URL)",
  "audioFile": "string (URL)",
  "duration": "number",
  "plays": "number",
  "createdAt": "string (ISO date)"
}
```

### Работа с файлами
- Файлы загружаются через `multipart/form-data` запросы
- Обработка файлов через Multer middleware
- Аудиофайлы хранятся в `/tmp/melodic-linker-uploads/audio`
- Обложки хранятся в `/tmp/melodic-linker-uploads/covers`

## Решенные проблемы

### 1. Проблема с хранением треков в памяти
**Проблема**: Треки хранились в массиве внутри приложения, что приводило к их потере при перезапуске сервера.

**Решение**: Добавлено сохранение примеров треков, которые загружаются при старте приложения, чтобы демо-версия всегда имела контент.

### 2. Проблема с отображением треков на главной странице
**Проблема**: Треки не отображались на главной странице после их загрузки через админ-панель.

**Решение**: 
- Добавлено расширенное логирование API запросов
- Исправлена структура данных с треками
- Улучшена обработка JSON-ответов на фронтенде

### 3. JavaScript ошибки с отсутствующими элементами
**Проблема**: В консоли было множество ошибок `Cannot read properties of null` из-за обращений к несуществующим DOM-элементам.

**Решение**:
- Добавлены проверки существования элементов перед добавлением обработчиков событий
- Обернуты обращения к DOM-элементам в проверки на null/undefined
- Добавлено логирование отсутствующих элементов для отладки

### 4. Воспроизведение аудио в браузере
**Проблема**: Аудиофайлы не воспроизводились, так как использовались неправильные URL.

**Решение**:
- Заменены URL демо-треков на рабочие внешние аудиофайлы
- Добавлена система резервного воспроизведения при ошибках
- Реализовано корректное отображение состояния воспроизведения с индикацией

### 5. Проблемы с деплоем на Heroku
**Проблема**: Приложение не запускалось на Heroku из-за проблем с Docker-образом.

**Решение**:
- Обновлен Dockerfile с корректными путями для копирования файлов
- Исправлена команда запуска приложения
- Настроены переменные окружения для Heroku
- Добавлено создание директории для загрузки файлов при старте

---

Документация составлена: 28 февраля 2025 года